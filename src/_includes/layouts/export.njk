<!DOCTYPE html>
<html lang="{{ lang if lang else defaultLanguage }}-CA" dir="ltr">
<head>
  {% include 'partials/global/meta.njk' %}
  <title>{{ title }}</title>
  {% set allCss %} {% include '../../assets/styles/all.css' %} {% endset %}
  {% set printCss %} {% include '../../assets/styles/print.css' %} {% endset %}
  {% if eleventy.env.runMode === 'serve' %}
  <script src="https://unpkg.com/pagedjs/dist/paged.polyfill.js"></script>
  <style>
    .pagedjs_pages {
        display: flex;
        flex-direction: column;
        gap: 0.25in;
        margin-block: 0.25in;
        margin-inline: auto;
        width: max-content;
    }

    .pagedjs_page {
        box-shadow: rgba(3, 4, 7, 0.13) 0px 3px 5px -2px, rgba(3, 4, 7, 0.15) 0px 7px 14px -5px,
            0 0 0 1px #aaa;
    }

    .pagedjs_page[data-page-number="3"],
    .pagedjs_page[data-page-number="6"],
    .pagedjs_page[data-page-number="10"],
    .pagedjs_page[data-page-number="19"],
    .pagedjs_page[data-page-number="49"] {
        background: black;

        .pagedjs_margin-content {
            display: none;
        }
    }

    .pagedjs_chapter-5_first_page {
        background-image: var(--background-image-5);
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }

    .pagedjs_chapter-6_first_page {
        background-image: var(--background-image-6);
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }

    .pagedjs_chapter-7_first_page {
        background-image: var(--background-image-7);
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }

    .pagedjs_chapter-8_first_page {
        background-image: var(--background-image-8);
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }

    .pagedjs_chapter-5_first_page .pagedjs_margin-content,
    .pagedjs_chapter-6_first_page .pagedjs_margin-content,
    .pagedjs_chapter-7_first_page .pagedjs_margin-content,
    .pagedjs_chapter-8_first_page .pagedjs_margin-content {
        display: none;
    }
  </style>
  {% endif %}
  {% include "partials/global/stylesheets-print.njk" %}
  <style>
      :root {
      {% for chapter in collections['chapters-' + lang] %}{% if chapter.data.backgroundImage and chapter.data.backgroundImage !== '' %}
        {% if deploy.local %}
        --background-image-{{ loop.index }}:url('http://localhost:8080{{ chapter.data.backgroundImage }}');
        {% else %}
        --background-image-{{ loop.index }}:url('{{ deploy.url }}{{ chapter.data.backgroundImage }}');
        {% endif %}
      {% endif %}{% endfor %}
      }
  </style>
</head>
<body>
  <main class="export">
  <div class="front-matter flow title">
        <div class="container">
            {% includeSvg "shapes.svg", "" %}
            <h1>{% __ "site-title" %}</h1>
            <p class="byline">{% __ "byline" %}</p>
            <div class="logos-and-meta">
                {% includeSvg "idrc.svg", site[lang].author %}
                {% includeSvg "ocadu.svg", site[lang].institution %}
                <div class="license-and-version flow">
                    <p class="version">{% __ 'version' %} {{ pkg.version }}</p>
                    <div class="license flow">
                        <p class="license-image">
                            <svg xmlns="http://www.w3.org/2000/svg" width="120" height="42" fill="none" viewBox="0 0 120 42">
                                <title>{% __ 'cc-by-nc' %}</title>
                                <path fill="currentColor" d="M31.971 8.433c3.024 3.024 4.536 6.726 4.536 11.105 0 4.38-1.486 8.043-4.458 10.988-3.153 3.102-6.88 4.653-11.18 4.653-4.25 0-7.913-1.538-10.988-4.614-3.076-3.075-4.614-6.751-4.614-11.027 0-4.275 1.538-7.977 4.614-11.105 2.997-3.024 6.66-4.536 10.987-4.536 4.38 0 8.08 1.512 11.103 4.536Zm-20.054 2.034c-2.557 2.582-3.834 5.606-3.834 9.075 0 3.468 1.265 6.467 3.794 8.996 2.53 2.53 5.542 3.794 9.037 3.794 3.495 0 6.532-1.277 9.114-3.833 2.452-2.373 3.678-5.358 3.678-8.957 0-3.572-1.246-6.604-3.737-9.094-2.49-2.49-5.508-3.736-9.055-3.736-3.547 0-6.546 1.252-8.997 3.755Zm6.727 7.55c-.39-.853-.976-1.278-1.756-1.278-1.378 0-2.067.928-2.067 2.783 0 1.856.69 2.784 2.067 2.784.91 0 1.561-.452 1.951-1.357l1.911 1.017c-.91 1.618-2.277 2.428-4.1 2.428-1.405 0-2.53-.431-3.376-1.293-.846-.861-1.269-2.05-1.269-3.563 0-1.488.436-2.669 1.308-3.543.872-.875 1.958-1.312 3.26-1.312 1.926 0 3.305.758 4.14 2.274l-2.069 1.06Zm8.99 0c-.39-.853-.965-1.278-1.72-1.278-1.406 0-2.11.928-2.11 2.783 0 1.856.704 2.784 2.11 2.784.912 0 1.55-.452 1.915-1.357l1.953 1.017c-.909 1.618-2.274 2.428-4.092 2.428-1.404 0-2.527-.431-3.372-1.293-.843-.861-1.266-2.05-1.266-3.563 0-1.488.43-2.669 1.287-3.543.857-.875 1.947-1.312 3.273-1.312 1.923 0 3.3.758 4.13 2.274l-2.108 1.06Z"/>
                                <path fill="currentColor" d="M117.753 0A2.25 2.25 0 0 1 120 2.246v39.247c0 .28-.228.507-.508.507H.508A.508.508 0 0 1 0 41.493V2.246A2.251 2.251 0 0 1 2.247 0h115.506ZM94.832 32.584a3.36 3.36 0 0 0-1.37.268c-.392.17-.742.424-1.026.743a3.294 3.294 0 0 0-.641 1.11 4.125 4.125 0 0 0-.224 1.377c-.003.46.072.917.224 1.352.14.402.357.773.64 1.09.286.314.636.562 1.027.728a3.41 3.41 0 0 0 1.37.265 3.23 3.23 0 0 0 1.121-.187 2.595 2.595 0 0 0 1.503-1.395 3.36 3.36 0 0 0 .288-1.123h-1.41c-.056.446-.21.806-.459 1.077-.251.273-.599.409-1.044.409-.328 0-.606-.063-.835-.19a1.586 1.586 0 0 1-.556-.505 2.18 2.18 0 0 1-.312-.71 3.614 3.614 0 0 1 0-1.655c.06-.259.165-.505.311-.727a1.56 1.56 0 0 1 .557-.51c.23-.127.507-.19.835-.19.175-.001.349.03.514.088.317.112.587.327.766.612.087.14.144.296.167.459h1.41a2.659 2.659 0 0 0-.315-1.02 2.443 2.443 0 0 0-.636-.748 2.797 2.797 0 0 0-.87-.46 3.346 3.346 0 0 0-1.035-.158Zm-37.957 6.785h3.215a3.38 3.38 0 0 0 .87-.111c.282-.074.533-.189.753-.344.22-.154.395-.354.525-.598a1.82 1.82 0 0 0 .195-.867c0-.415-.1-.77-.302-1.063-.202-.294-.507-.5-.917-.617.297-.142.522-.324.673-.547.152-.223.228-.5.228-.833 0-.31-.051-.57-.153-.78a1.273 1.273 0 0 0-.432-.505 1.86 1.86 0 0 0-.67-.273 4.112 4.112 0 0 0-.863-.084h-3.122v6.622Zm8.246-2.578v2.578h1.46v-2.542l2.459-4.08h-1.624l-1.542 2.615-1.55-2.615h-1.633l2.43 4.044Zm19.863-4.044v6.622h1.366v-4.434h.02l2.755 4.434h1.457v-6.622h-1.367v4.443H89.2l-2.766-4.443h-1.45ZM2.247 1.014c-.679 0-1.232.552-1.232 1.232v27.21h4.32c3.025 5.473 8.853 9.184 15.547 9.184 6.69 0 12.52-3.715 15.546-9.185h82.557V2.246c0-.679-.552-1.232-1.232-1.232H2.247Zm57.677 35.405c.316 0 .569.073.761.218.192.145.289.387.289.727a.9.9 0 0 1-.088.426.704.704 0 0 1-.237.265 1.032 1.032 0 0 1-.344.14 2.016 2.016 0 0 1-.408.041h-1.563V36.42h1.59Zm-.225-2.538c.126 0 .252.01.376.032.113.019.22.058.32.115a.624.624 0 0 1 .224.232c.06.117.089.248.083.38 0 .277-.083.477-.25.6-.168.123-.381.186-.642.186h-1.476V33.88h1.365Z"/>
                                <path fill="currentColor" d="M91.743 3.385c3.25 0 5.999 1.12 8.244 3.362 2.244 2.242 3.367 4.987 3.367 8.234 0 3.246-1.103 5.96-3.31 8.146-2.341 2.3-5.108 3.448-8.3 3.448-3.156 0-5.874-1.14-8.158-3.42-2.283-2.28-3.425-5.005-3.425-8.174 0-3.17 1.142-5.915 3.425-8.234 2.226-2.241 4.945-3.362 8.157-3.362Zm-8.973 8.48a9.288 9.288 0 0 0-.518 3.116c0 2.57.937 4.79 2.814 6.667 1.877 1.874 4.112 2.81 6.706 2.81 2.593 0 4.847-.945 6.763-2.84a8.922 8.922 0 0 0 1.585-2.028l-4.373-1.946c-.296 1.47-1.606 2.464-3.19 2.58v1.788h-1.332v-1.788c-1.301-.014-2.56-.547-3.52-1.388l1.596-1.61c.77.724 1.54 1.049 2.59 1.049.68 0 1.434-.267 1.434-1.153a.868.868 0 0 0-.313-.696l-1.106-.493-1.377-.613c-.68-.304-1.257-.56-1.836-.817l-5.923-2.638Zm9.002-6.393c-2.632 0-4.857.927-6.676 2.783a10.73 10.73 0 0 0-1.292 1.566l4.434 1.974c.4-1.23 1.568-1.976 2.987-2.058V7.949h1.33v1.788c.919.044 1.924.295 2.915 1.063l-1.524 1.566c-.562-.4-1.271-.68-1.982-.68-.576 0-1.39.177-1.39.9 0 .112.037.209.105.295l1.482.66 1.004.447c.64.287 1.255.559 1.862.83l5.942 2.644c.201-.812.3-1.645.295-2.481 0-2.65-.93-4.89-2.787-6.726-1.84-1.856-4.074-2.783-6.705-2.783Zm-25.304 6.641a.75.75 0 0 0-.75-.75h-4.742a.749.749 0 0 0-.749.749v4.743h1.322v5.616h3.595v-5.616h1.324v-4.742Zm-3.121-1.375a1.622 1.622 0 1 0 0-3.244 1.622 1.622 0 0 0 0 3.244Z"/>
                                <path fill="currentColor" fill-rule="evenodd" d="M63.333 3.388c-3.212 0-5.932 1.12-8.157 3.361-2.284 2.32-3.425 5.064-3.425 8.233 0 3.17 1.14 5.895 3.425 8.175 2.283 2.28 5.002 3.42 8.157 3.42 3.192 0 5.96-1.149 8.3-3.449 2.207-2.184 3.31-4.898 3.31-8.146 0-3.247-1.122-5.99-3.366-8.233-2.246-2.241-4.994-3.361-8.244-3.361Zm.028 2.086c2.632 0 4.867.928 6.705 2.783 1.859 1.836 2.788 4.077 2.788 6.725 0 2.667-.91 4.88-2.729 6.638-1.916 1.894-4.17 2.841-6.764 2.841-2.593 0-4.828-.937-6.705-2.812-1.878-1.874-2.815-4.097-2.815-6.667 0-2.57.948-4.812 2.844-6.725 1.819-1.855 4.045-2.783 6.676-2.783Z" clip-rule="evenodd"/>
                            </svg>
                        </p>
                        <p>
                            {% __ 'license' %}
                        </p>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="front-matter flow toc">
        <div class="container">
            <h2 data-toc>{% __ "toc" %}</h2>
            <nav>
                <div id="toc">
                    <ol></ol>
                </div>
            </nav>
        </div>
    </div>
    {% for chapter in collections['chapters-' + lang] %}
    <div class="chapter {{ chapter.data.type }} flow" data-chapter="{{ loop.index }}">
        {% if chapter.data.type === 'narrative' %}
        <div class="hidden-title">{{ chapter.data.title | renderContent("md") | striptags }}</div>
        {% set pieces = chapter.data.title | split(': ') %}
        <h2 data-narrative><span class="surtitle">{{ pieces[0] }}</span> {{ pieces[1] | renderContent('md') | replace('<p>', '') | replace('</p>', '') | safe }}</h2>
        {% else %}
        <h2>{{ chapter.data.title | renderContent('md') | replace('<p>', '') | replace('</p>', '') | safe }}</h2>
        {% endif %}
        {% if chapter.data.introduction and chapter.data.introduction !== '' %}
        <div class="introduction flow">
            {{ chapter.data.introduction | renderContent("md") | safe }}
        </div>
        {% endif %}
        {{ chapter.templateContent | renderContent('md') | safe }}
    </div>
    {% endfor %}
    {% for backMatter in collections['back-matter-' + lang] %}
    <div class="back-matter flow">
        <h2>{{ backMatter.data.title }}</h2>
        {{ backMatter.templateContent | renderContent('md') | safe }}
    </div>
    {% endfor %}
  </main>
</body>
</html>
